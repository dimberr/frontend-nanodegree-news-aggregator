APP.Main=function(){function q(a,b){var c=document.querySelector("#s-"+a);b.time*=1e3;var d=n(b);c.addEventListener("click",r.bind(this,b)),c.classList.add("clickable"),h--,0===h&&requestAnimationFrame(v),c.innerHTML=d}function r(a){var b=document.querySelector("[id^=sd]");b||(b=document.createElement("section")),requestAnimationFrame(s.bind(this,a.id)),a.url&&(a.urlobj=new URL(a.url));var c,d,e,f,g=o(a),h=a.kids,j=p({by:"",text:"Loading comment..."});b.innerHTML=g,d=b.querySelector(".js-comments"),e=b.querySelector(".js-header"),f=b.querySelector(".js-content");var k=b.querySelector(".js-close");k.addEventListener("click",t.bind(this,a.id));var l=e.getBoundingClientRect().height;if(f.style.paddingTop=l+"px",b.setAttribute("id","sd-"+a.id),b.classList.add("story-details"),"undefined"!=typeof h){for(var m=0;m<h.length;m++)c=document.createElement("aside"),c.setAttribute("id","sdc-"+h[m]),c.classList.add("story-details__comment"),c.innerHTML=j,d.appendChild(c),APP.Data.getStoryComment(h[m],function(a){a.time*=1e3;var b=d.querySelector("#sdc-"+a.id);b.innerHTML=p(a,i)});document.body.appendChild(b)}}function s(a){function f(){null===d&&(d=e.left),d+=.1*(0-e.left),Math.abs(d)>.5?requestAnimationFrame(f):d=0,c.style.left=d+"px",c.style.opacity=1}if(!g){g=!0;var c=b("#sd-"+a),d=null;if(c){var e=c.getBoundingClientRect();document.body.classList.add("details-active"),requestAnimationFrame(f)}}}function t(a){function e(){var a=f.getBoundingClientRect(),b=c.getBoundingClientRect(),h=a.width+100;d+=.1*(h-b.left),Math.abs(d-h)>.5?requestAnimationFrame(e):(d=h,g=!1),c.style.left=d+"px"}if(g){var c=b("#sd-"+a),d=0;document.body.classList.remove("details-active"),c.style.opacity=0,requestAnimationFrame(e)}}function u(a,b,c,d){this.story=a,this.scale=b,this.opacity=c,this.saturation=d}function v(){for(var a=document.querySelectorAll(".story"),b=[],c=0;c<a.length;c++){var d=a[c],e=d.getBoundingClientRect().top;if(e>=0&&e<=window.innerHeight){var g=d.querySelector(".story__score"),i=(d.querySelector(".story__title"),f.offsetHeight),k=(f.getBoundingClientRect(),g.getBoundingClientRect().top-document.body.getBoundingClientRect().top),l=Math.min(1,1-.05*((k-170)/i)),m=Math.min(1,1-.5*((k-170)/i)),o=(g.getBoundingClientRect().width,100*((40*l-38)/2));b.push(new u(d,l,m,o))}}b.forEach(function(a){var b=a.story.querySelector(".story__score"),c=a.story.querySelector(".story__title");b.style.width=40*a.scale+"px",b.style.height=40*a.scale+"px",b.style.lineHeight=40*a.scale+"px",b.style.backgroundColor="hsl(42, "+a.saturation+"%, 50%)",c.style.opacity=a.opacity})}function w(){if(!(h>0)){h=e;for(var a=d+e,b=d;b<a;b++){if(b>=c.length)return;var g=String(c[b]),i=document.createElement("div");i.setAttribute("id","s-"+g),i.classList.add("story"),i.innerHTML=n({title:"...",score:"-",by:"...",time:0}),f.appendChild(i),APP.Data.getStoryById(c[b],q.bind(this,g))}d+=e}}var a=300,b=document.querySelector.bind(document),c=null,d=0,e=15,f=b("main"),g=!1,h=0,i={data:{intl:{locales:"en-US"}}},j=b("#tmpl-story").textContent,k=b("#tmpl-story-details").textContent,l=b("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var m=/, {{ formatRelative time }}/;j=j.replace(m,""),k=k.replace(m,""),l=l.replace(m,"")}var n=Handlebars.compile(j),o=Handlebars.compile(k),p=Handlebars.compile(l);f.addEventListener("touchstart",function(a){Math.random()>.97&&a.preventDefault()}),f.addEventListener("scroll",function(){var c=b("header"),e=(c.querySelector(".header__title-wrapper"),f.scrollTop);Math.min(70,e);e>70?document.body.classList.add("raised"):document.body.classList.remove("raised");var i=f.scrollHeight-f.offsetHeight-a;e>i&&w(),v()}),APP.Data.getTopStories(function(a){c=a,w(),f.classList.remove("loading")})}();